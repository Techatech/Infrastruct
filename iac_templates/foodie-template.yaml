# AWS CloudFormation Template
# Generated by Infrastruct on 2025-10-10 02:57:00
# Environment: dev
# 
# This template follows Infrastruct tagging conventions:
# - Name: {envid}-ResourceType-InstanceNumber
# - Environment: {envid}
# - CreatedBy: Infrastruct
#
# Deploy with: aws cloudformation create-stack --stack-name dev-infrastructure --template-body file://template.yaml

AWSTemplateFormatVersion: '2010-09-09'
Description: Infrastructure as Code template generated by Infrastruct for dev environment
Parameters:
  EnvironmentId:
    Type: String
    Default: dev
    Description: Environment identifier for resource naming and tagging
Resources:
  Bucket01:
    Type: AWS::S3::Bucket
    Properties:
      BucketName:
        Fn::Sub: ${EnvironmentId}-${AWS::AccountId}-${AWS::Region}-bucket
      Tags:
      - Key: Name
        Value: dev-Bucket01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-10'
      - Key: ManagedBy
        Value: CloudFormation
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
  Function01:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName:
        Fn::Sub: ${EnvironmentId}-function
      Runtime: python3.9
      Handler: index.handler
      Code:
        ZipFile: "def handler(event, context):\n    return {'statusCode': 200, 'body':\
          \ 'Hello from Lambda!'}"
      Role:
        Fn::GetAtt:
        - LambdaExecutionRole
        - Arn
      Tags:
      - Key: Name
        Value: dev-Function01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-10'
      - Key: ManagedBy
        Value: CloudFormation
  Table01:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName:
        Fn::Sub: ${EnvironmentId}-table
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      Tags:
      - Key: Name
        Value: dev-Table01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-10'
      - Key: ManagedBy
        Value: CloudFormation
Outputs:
  Bucket01Id:
    Description: ID of Bucket01
    Value:
      Ref: Bucket01
    Export:
      Name:
        Fn::Sub: ${dev}-Bucket01-Id
