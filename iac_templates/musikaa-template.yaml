# AWS CloudFormation Template
# Generated by Infrastruct on 2025-10-11 09:27:50
# Environment: dev
# 
# This template follows Infrastruct tagging conventions:
# - Name: {envid}-ResourceType-InstanceNumber
# - Environment: {envid}
# - CreatedBy: Infrastruct
#
# Deploy with: aws cloudformation create-stack --stack-name dev-infrastructure --template-body file://template.yaml

AWSTemplateFormatVersion: '2010-09-09'
Description: Infrastructure as Code template generated by Infrastruct for dev environment
Parameters:
  EnvironmentId:
    Type: String
    Default: dev
    Description: Environment identifier for resource naming and tagging
Resources:
  Instance01:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0abcdef1234567890
      InstanceType: t3.micro
      SecurityGroupIds:
      - Ref: WebSecurityGroup
      Tags:
      - Key: Name
        Value: dev-Server01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
      UserData:
        Fn::Base64:
          Fn::Sub: '#!/bin/bash

            yum update -y

            yum install -y httpd

            systemctl start httpd

            systemctl enable httpd

            echo ''<h1>Hello from ${EnvironmentId}</h1>'' > /var/www/html/index.html'
  Instance02:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0abcdef1234567890
      InstanceType: t3.micro
      SecurityGroupIds:
      - Ref: WebSecurityGroup
      Tags:
      - Key: Name
        Value: dev-Server02
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
      UserData:
        Fn::Base64:
          Fn::Sub: '#!/bin/bash

            yum update -y

            yum install -y httpd

            systemctl start httpd

            systemctl enable httpd

            echo ''<h1>Hello from ${EnvironmentId}</h1>'' > /var/www/html/index.html'
  DBInstance01:
    Type: AWS::RDS::DBInstance
    Properties:
      DBInstanceClass: db.t3.micro
      Engine: mysql
      MasterUsername: admin
      MasterUserPassword: ChangeMe123!
      AllocatedStorage: '20'
      DBName:
        Fn::Sub: ${EnvironmentId}database
      Tags:
      - Key: Name
        Value: dev-Database01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
  Bucket01:
    Type: AWS::S3::Bucket
    Properties:
      BucketName:
        Fn::Sub: ${EnvironmentId}-${AWS::AccountId}-${AWS::Region}-bucket
      Tags:
      - Key: Name
        Value: dev-Bucket01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
  Bucket02:
    Type: AWS::S3::Bucket
    Properties:
      BucketName:
        Fn::Sub: ${EnvironmentId}-${AWS::AccountId}-${AWS::Region}-bucket
      Tags:
      - Key: Name
        Value: dev-Bucket02
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
  Bucket03:
    Type: AWS::S3::Bucket
    Properties:
      BucketName:
        Fn::Sub: ${EnvironmentId}-${AWS::AccountId}-${AWS::Region}-bucket
      Tags:
      - Key: Name
        Value: dev-Bucket03
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
  LoadBalancer01:
    Type: AWS::ElasticLoadBalancingV2::LoadBalancer
    Properties:
      Name:
        Fn::Sub: ${EnvironmentId}-loadbalancer
      Scheme: internet-facing
      Type: application
      Tags:
      - Key: Name
        Value: dev-LoadBalancer01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
  Distribution01:
    Type: AWS::CloudFront::Distribution
    Properties:
      Tags:
      - Key: Name
        Value: dev-CDN01
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
  Distribution02:
    Type: AWS::CloudFront::Distribution
    Properties:
      Tags:
      - Key: Name
        Value: dev-CDN02
      - Key: Environment
        Value: dev
      - Key: CreatedBy
        Value: Infrastruct
      - Key: CreatedDate
        Value: '2025-10-11'
      - Key: ManagedBy
        Value: CloudFormation
Outputs:
  Instance01Id:
    Description: ID of Instance01
    Value:
      Ref: Instance01
    Export:
      Name:
        Fn::Sub: ${dev}-Instance01-Id
  Instance02Id:
    Description: ID of Instance02
    Value:
      Ref: Instance02
    Export:
      Name:
        Fn::Sub: ${dev}-Instance02-Id
  Bucket01Id:
    Description: ID of Bucket01
    Value:
      Ref: Bucket01
    Export:
      Name:
        Fn::Sub: ${dev}-Bucket01-Id
  Bucket02Id:
    Description: ID of Bucket02
    Value:
      Ref: Bucket02
    Export:
      Name:
        Fn::Sub: ${dev}-Bucket02-Id
  Bucket03Id:
    Description: ID of Bucket03
    Value:
      Ref: Bucket03
    Export:
      Name:
        Fn::Sub: ${dev}-Bucket03-Id
  LoadBalancer01Id:
    Description: ID of LoadBalancer01
    Value:
      Ref: LoadBalancer01
    Export:
      Name:
        Fn::Sub: ${dev}-LoadBalancer01-Id
